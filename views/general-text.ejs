<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1920, maximum-scale=1.0" />
    <link rel="shortcut icon" type="image/png" href="https://animaproject.s3.amazonaws.com/home/favicon.png" />
    <meta name="og:type" content="website" />
    <meta name="twitter:card" content="photo" />
    <link rel="stylesheet" type="text/css" href="css/general-text.css" />
    <link rel="stylesheet" type="text/css" href="css/styleguide.css" />
    <link rel="stylesheet" type="text/css" href="css/globals.css" />
  </head>
  <body style="margin: 0; background: #ffffff">
    <input type="hidden" id="anPageName" name="page" value="general-text" />
    <div class="container-center-horizontal">
      <div class="general-text screen">
        <div class="bg-eQxjhj">
          <div class="bg-style-mqWMxy">
            <img class="path-363-YjYywB" src="img/path-129@1x.png" alt="Path 363" />
            <img class="path-364-YjYywB" src="img/path-364@1x.png" alt="Path 364" />
            <img class="person-YjYywB" src="img/person-10@1x.png" alt="Person" />
            <img class="arrow-YjYywB" src="img/arrow-1@1x.png" alt="Arrow" />
          </div>
          <div class="main-header-mqWMxy"></div>
          <div class="logo-mqWMxy">
            <div class="logo-ojsjwS">
              <div class="m-qyoR3u"><img class="path-370-p0qjai" src="img/path-370@1x.png" alt="Path 370" /></div>
              <div class="v-qyoR3u"><img class="path-371-xza14Z" src="img/path-295@1x.png" alt="Path 371" /></div>
              <div class="e-qyoR3u"><img class="path-372-9H46zY" src="img/path-296@1x.png" alt="Path 372" /></div>
              <div class="group-201-qyoR3u">
                <img class="rectangle-66-rNar0t" src="img/rectangle-11@1x.png" alt="Rectangle 66" />
              </div>
              <div class="group-202-qyoR3u">
                <img class="path-373-lfEfQF" src="img/path-373@1x.png" alt="Path 373" />
                <img class="path-374-lfEfQF" src="img/path-110@1x.png" alt="Path 374" />
                <img class="path-375-lfEfQF" src="img/path-111@1x.png" alt="Path 375" />
              </div>
              <div class="pin-qyoR3u">
                <img class="path-376-43D6wP" src="img/path-376@1x.png" alt="Path 376" />
                <div class="ellipse-20-43D6wP"></div>
              </div>
              <div class="box-qyoR3u">
                <img class="rectangle-67-qqLcep" src="img/rectangle-12@1x.png" alt="Rectangle 67" />
              </div>
            </div>
          </div>
        </div>
        <a href="/new-lable">
          <div class="new-lable-button-eQxjhj">
            <div class="group-375-D1ksW6 smart-layers-pointers">
              <div class="green-button-new-lable-sxsSY4"></div>
              <div class="x-sxsSY4 smart-layers-pointers">
                <img class="path-464-toiKrU" src="img/path-464-11-1x-png@1x.png" alt="Path 464" />
                <img class="path-465-toiKrU" src="img/path-465-10-1x-png@1x.png" alt="Path 465" />
              </div>
              <div class="new-lable-sxsSY4 lato-normal-white-39-8px">New lable</div>
            </div>
          </div></a
        >
        <div class="main-shape-eQxjhj">
          <div class="main-shape-JxDw3i">
            <div class="rectangle-68-zhfSnj"></div>
            <img class="path-377-zhfSnj" src="img/path-377-1@1x.png" alt="Path 377" />
            <div class="box-icon-zhfSnj">
              <div class="group-203-DYvDex">
                <img class="path-378-3POs2y" src="img/path-302@1x.png" alt="Path 378" />
              </div>
              <div class="group-204-DYvDex">
                <img class="path-379-hHxDY8" src="img/path-303@1x.png" alt="Path 379" />
              </div>
              <div class="group-205-DYvDex">
                <img class="path-380-xGzAm6" src="img/path-304@1x.png" alt="Path 380" />
              </div>
              <div class="group-206-DYvDex">
                <img class="path-381-AR9cGi" src="img/path-305@1x.png" alt="Path 381" />
                <img class="path-382-AR9cGi" src="img/path-306@1x.png" alt="Path 382" />
                <img class="path-383-AR9cGi" src="img/path-307@1x.png" alt="Path 383" />
              </div>
              <div class="group-207-DYvDex">
                <img class="path-384-p9D9kJ" src="img/path-308@1x.png" alt="Path 384" />
              </div>
              <div class="group-208-DYvDex">
                <img class="path-385-6VdxVa" src="img/path-309@1x.png" alt="Path 385" />
                <img class="path-386-6VdxVa" src="img/path-307@1x.png" alt="Path 386" />
              </div>
              <div class="group-209-DYvDex">
                <img class="path-387-f8jFTZ" src="img/path-311@1x.png" alt="Path 387" />
              </div>
              <div class="group-210-DYvDex">
                <img class="path-388-ni82FL" src="img/path-307@1x.png" alt="Path 388" />
              </div>
              <img class="path-389-DYvDex" src="img/path-313@1x.png" alt="Path 389" />
              <div class="group-211-DYvDex">
                <img class="path-390-jxxq7K" src="img/path-314@1x.png" alt="Path 390" />
                <img class="path-391-jxxq7K" src="img/path-315@1x.png" alt="Path 391" />
              </div>
              <div class="group-212-DYvDex">
                <img class="path-392-vp4MTc" src="img/path-307@1x.png" alt="Path 392" />
              </div>
            </div>
            <h1 class="title-zhfSnj title lato-black-white-81-1px">Titel :</h1>
            <div class="whats-inside-the-box-zhfSnj lato-black-black-40-1px">What&#39;s inside the box?..</div>
            <div class="rectangle-70-zhfSnj"></div>
          </div>
        </div>
        <!-- Updated Check Button -->
        <a href="/login">
          <div class="sign-out-eQxjhj smart-layers-pointers">
            <div class="group-377-rNVDsj">
              <div class="sign-out-knUpiM montserrat-normal-torch-red-37-7px">Sign out</div>
              <img class="path-466-knUpiM smart-layers-pointers" src="img/path-466-10@1x.png" alt="Path 466" />
              <div class="group-373-knUpiM">
                <img class="path-467-VY0ai3" src="img/path-467-10@1x.png" alt="Path 467" />
                <img class="path-468-VY0ai3" src="img/path-468-10@1x.png" alt="Path 468" />
              </div>
            </div></div></a
        ><a href="/search">
          <div class="search-bar-eQxjhj smart-layers-pointers">
            <a href="search.html" onclick="window.event.stopPropagation()"> <div class="search-box-lnxXoz"></div></a
            ><img class="search-icon-lnxXoz smart-layers-pointers" src="img/search-icon-12@1x.png" alt="search icon" />
            <input
              class="seach-for-a-specific-lable-lnxXoz lato-black-white-30px"
              name="seach-for-a-specific-lable-215"
              placeholder="Seach for a specific lable ..."
              type="text"
              required
            /></div></a
        ><a href="/new-lable">
          <div class="cancel-eQxjhj smart-layers-pointers">
            <img class="cancel-i6Algq" src="img/cancel-13@1x.png" alt="Cancel" /></div
        ></a>
            <!-- Title Field -->
            <div class="title-eQxjhj title">
              <div class="rectangle-194-600u3V"></div>
              <textarea
                class="titel-600u3V lato-black-white-55px"
                name="titel19"
                id="label-name"
                placeholder="What will you name your box?..."
                type="text"
                required
              ></textarea>
            </div>
            <!-- Memo Field -->
            <div class="type-field-eQxjhj">
              <div class="box-field-NO1e3r"></div>
              <textarea
                class="start-typing-here-NO1e3r lato-black-white-20px"
                name="start-typing-here-12"
                id="memo"
                placeholder="Start typing here ..."
                type="text"
                required
              ></textarea>
            </div>
            <button id="check-button" type="button">
              <div class="done-eQxjhj smart-layers-pointers">
                <img class="done-1XY3QZ" src="img/done-1@1x.png" alt="Done" />
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
          const labelNameInput = document.getElementsByName('titel19')[0]; // Select by name
          const memoInput = document.getElementsByName('start-typing-here-12')[0]; // Select by name
          const checkButton = document.getElementById('check-button');
  
          // Extract query parameters from the URL
          const urlParams = new URLSearchParams(window.location.search);
          const labelName = urlParams.get('titel114'); // Get the label name
          const categoryId = urlParams.get('category_id') || 3; // Get the category ID, default to 3 if not present
          const publicStatus = urlParams.get('public') === 'true'; // Get the public status as a boolean
  
          // Populate the label name input if it exists
          if (labelName) {
              labelNameInput.value = labelName;
          }
  
          // Listen for the check button click
          checkButton.addEventListener('click', async (event) => {
              event.preventDefault();
  
              const labelNameValue = labelNameInput ? labelNameInput.value.trim() : undefined;
              const memo = memoInput ? memoInput.value.trim() : undefined;
  
              // Debugging: Log the values to be sent to the server
              console.log('Label Name:', labelNameValue);
              console.log('Memo:', memo);
              console.log('Category ID:', categoryId);
              console.log('Public Status:', publicStatus);
  
              if (!labelNameValue) {
                  alert('Label title is required!');
                  return;
              }
  
              try {
                // Send the data to the backend using fetch
                const response = await fetch('/new-lable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        titel19: labelNameValue, // Use name attribute as key
                        'start-typing-here-12': memo, // Use name attribute as key
                        category_id: categoryId, // Use the category ID
                        public: publicStatus, // Include the public status
                    }),
                });

                // Debugging: Log the response status
                console.log('Response Status:', response.status);

                // Check if the response is JSON
                const contentType = response.headers.get('content-type');
                let result;
                if (contentType && contentType.includes('application/json')) {
                    result = await response.json();
                } else {
                    console.error('Expected JSON response but received:', contentType);
                    throw new Error('Unexpected response format');
                }

                console.log('Response Body:', result);

                if (!response.ok) {
                    console.error('Server Error:', result);
                    alert(`Error creating label: ${result.message}`);
                    return;
                }

                if (result.success) {
                    // Redirect to the URL provided in the server response
                    window.location.href = result.redirectUrl;
                } else {
                    alert('Error creating label: ' + result.message);
                }
            } catch (error) {
                console.error('Error during label creation:', error);
                alert('An unexpected error occurred! Check the console for more details.');
            }
          });
      });
  </script>
  
  </body>
</html>